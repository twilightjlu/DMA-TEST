# DMA TEST

### 基本介绍

基于sv编写的DMA测试平台，进行基本的功能测试，其基本特性有：

- 通过AXI LITE总线配置DMA CSR，通过 AXI FULL与内存交互
- 包含一个AXI接口的内存模型，支持突发传输中的INCR/FIX传输模式
- 可配置的测试轮数、测试内存地址以及传输字节数、AXI突发传输数量

目前包含如下测试函数：

|          名称          |                    基本功能                     |                             说明                             |
| :--------------------: | :---------------------------------------------: | :----------------------------------------------------------: |
|    test_dma_csrs()     |    对DMA两个描述符的CSR进行基本的读、写测试     |       错误、状态相关寄存器仅支持读，因而未进行读写测试       |
| test_dma_single_desc() |       对DMA的单个描述符进行基本的传输测试       |         测试流程：配置DMA描述符->传输数据->校验数据          |
|  test_dma_full_desc()  | 对DMA的所有描述符进行基本的传输测试，此处为两个 |         测试流程：配置DMA描述符->传输数据->校验数据          |
|    test_dma_abort()    |             对DMA的传输中断进行测试             | 测试流程：配置DMA描述符->中断传输->校验是否传输完毕->关闭传输。此测验与后一测验(可自行搭配)联合检验传输中断后的重新传输是否正常 |
|    test_dma_modes()    |              测试DMA传输的各个模式              |              分别包含读、写地址的自增、固定模式              |
|    test_dma_error()    |                DMA的错误注入检验                |      测试DMA在AXI传输发生错误时是否能捕获错误并触发中断      |
| test_dma_trans_byte()  |              测试DMA最大传输数据量              |                                                              |

### 已知问题

测试中存在的问题：

- 当传输的字节数小于配置的AXI突发传输字节数时会出现传输卡死，DMA不会捕捉这一错误。

- 当配置的AXI BURST数和需要传输的字节数不对齐时，部分情况下会出现传输卡死，，DMA不会捕捉这一错误。

- 目前单次传输数据大于300KB左右时会出现传输卡死，且传输数据量最大值与AXI BURST长度配置相关，DMA不会捕捉这一错误。

  | AXI BURST |    最大传输数据    | 传输报错值 |
  | :-------: | :----------------: | :--------: |
  |    256    | 317184B（约309KB） |  317440B   |
  |    128    | 314624B（约307KB） |  314880B   |
  |    64     | 310016B（约302KB） |  310272B   |

  

- 当传输被连续中断大于两次时，后一次传输会出现异常。表现为DMA进对内存进行读操作而不发起写操作，DMA不会捕捉这一错误。同时DMA不支持传输中断后继续上一次传输，否则传输错误，即在传输被中断后只能进行新的传输。

### TODO

- 目前DMA错误注入仅支持传输数据错误注入，不支持DMA CSR配置时错误注入。

  

